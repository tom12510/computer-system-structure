## Schema与数据类型优化

> #### 数据类型选择
>
> - 满足业务最小的数据类型
>
> - 避免NULL设计
>
> - 使用整形代替字符集
>
> - DATETIME 与TIMESAMP 区别
>
>   > | DATETIME                                               | TIMESAMP                                                |
>   > | ------------------------------------------------------ | ------------------------------------------------------- |
>   > | 8字节                                                  | 4字节                                                   |
>   > | 不存在时区问题                                         | 以世间标准时间存储,查询时转换客户端当前时区进行返回     |
>   > | 1000-01-01 00:00:00.000000 ~9999-12-31 23:59:59.999999 | 1970-01-01 00:00:01.000000 ~ 2038-01-19 03:14:07.999999 |
>
> - 整数类型
>
>   > TINYINT SMALLINT MEDIUMINT  INT BIGINT  8,16,24,32,64位存储空间  范围值 $-2^{N-1}到2^{N-1}-1$
>   >
>   > UNSIGNED 不存在负数部分,使得正数存储返回提高一倍
>   >
>   > **对于指定整数类型宽度没有意义**  int(1) 与 int(20) 相同
>
> - 实数类型
>
>   > FLOAT,DOUBLE,DECIMAL(**精确小数计算,最多65个数字**),计算大量数字时使用整数和倍率进行小数转换
>
> - 字符串类型(与存储引擎相关)
>
>   > VARCHAR 与CHAR
>   >
>   > > VARCHAR可变长字符串
>   > >
>   > > CHAR 定长字符串(等长情况下性能高于VARCHAR)
>   >
>   > BINARY 与 VARBINARY 存储**二进制字符串**
>   >
>   > 
>   >
>   > BOLB与TEXT类型 
>   >
>   > > BOLE无排序规则 与字符集   TEXT存在排序规则与字符集
>   >
>   > 使用枚举(ENUM)代替字符串类型
>   
> - 位数据类型
>
>   > BIT 可以在一列中存储多个 true/false值 BIT最长64位
>   >
>   > SET 存储多个true/false 
>
> - 选择标识符(identifier)
>
> #### **Sehema设计**
>
> > - 避免过多的列(销耗查询性能)
> > - 关联过多
> >
> > **范式和反范式**
> >
> > > 1. 确保每列数据原子性
> > > 2. 确保表中的每一列都与主键相关
> > > 3. 确保每列都和主键直接相关(不存在间接相关属性)
> >
> > **缓存表和汇总表**
> >
> > > 汇总表通常使用group by 对元素数据进行统计汇总
> > >
> > > 数据查询慢而需要经常使用的数据进行优化
> >
> > **计数器表**
> >
> > > 使用多行数据分组统计累加值(避免全局互斥锁)提高事务并发性
> > >
> > > ~~~sql
> > > update hit_counter set cnt = cnt +1 where slot = RAND()*100;
> > > select sum(cnt) from hit_counter;
> > > ~~~
> >
> > 

